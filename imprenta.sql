--
-- PostgreSQL database dump
--

\restrict pNZ0j2nwKg3qf0Kbs17QiOZ7BLDn1Kk976cHoY7de7qpgtznbn1k1moBj4rTjAb

-- Dumped from database version 16.10 (Ubuntu 16.10-0ubuntu0.24.04.1)
-- Dumped by pg_dump version 16.10 (Ubuntu 16.10-0ubuntu0.24.04.1)

SET statement_timeout = 0;
SET lock_timeout = 0;
SET idle_in_transaction_session_timeout = 0;
SET client_encoding = 'UTF8';
SET standard_conforming_strings = on;
SELECT pg_catalog.set_config('search_path', '', false);
SET check_function_bodies = false;
SET xmloption = content;
SET client_min_messages = warning;
SET row_security = off;

--
-- Name: avanzar_etapa_y_estado(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.avanzar_etapa_y_estado() RETURNS trigger
    LANGUAGE plpgsql
    AS $$
DECLARE
    etapa_actual_orden INTEGER;
    etapa_max_orden INTEGER;
    siguiente_etapa_id INTEGER;
    estado_finalizado_id INTEGER;
    estado_entregado_id INTEGER;
BEGIN
    -- Obtener el orden de la etapa actual
    SELECT e.orden INTO etapa_actual_orden
    FROM "OrdenTrabajo" ot
    JOIN "Etapa" e ON ot.id_etapa = e.id_etapa
    WHERE ot.id_orden_trabajo = NEW.id_orden_trabajo;

    -- Obtener el máximo orden de etapa
    SELECT MAX(orden) INTO etapa_max_orden FROM "Etapa";

    -- Obtener los IDs de los estados
    SELECT id_estado INTO estado_finalizado_id FROM "Estado" WHERE nombre = 'Finalizado';
    SELECT id_estado INTO estado_entregado_id FROM "Estado" WHERE nombre = 'Entregado';

    -- Si no está en la última etapa, avanzar a la siguiente
    IF etapa_actual_orden < etapa_max_orden THEN
        SELECT id_etapa INTO siguiente_etapa_id FROM "Etapa" WHERE orden = etapa_actual_orden + 1;
        UPDATE "OrdenTrabajo"
        SET id_etapa = siguiente_etapa_id
        WHERE id_orden_trabajo = NEW.id_orden_trabajo;
    END IF;

    -- Si el trigger viene de ControlCalidadFinal, poner estado en "finalizado"
    IF TG_TABLE_NAME = 'ControlCalidadFinal' THEN
        UPDATE "OrdenTrabajo"
        SET id_estado = estado_finalizado_id
        WHERE id_orden_trabajo = NEW.id_orden_trabajo;
    END IF;

    -- Si el trigger viene de Remito, poner estado en "entregado"
    IF TG_TABLE_NAME = 'Remito' THEN
        UPDATE "OrdenTrabajo"
        SET id_estado = estado_entregado_id
        WHERE id_orden_trabajo = NEW.id_orden_trabajo;
    END IF;

    RETURN NEW;
END;
$$;


ALTER FUNCTION public.avanzar_etapa_y_estado() OWNER TO postgres;

--
-- Name: inicializar_etapa_estado_orden(); Type: FUNCTION; Schema: public; Owner: postgres
--

CREATE FUNCTION public.inicializar_etapa_estado_orden() RETURNS trigger
    LANGUAGE plpgsql
    AS $$DECLARE
    etapa_inicial_id INTEGER;
    estado_en_proceso_id INTEGER;
BEGIN
    -- Buscar la etapa con menor orden (PrePrensa)
    SELECT id_etapa INTO etapa_inicial_id FROM "Etapa" WHERE orden = 1;
    -- Buscar el id del estado "en proceso"
    SELECT id_estado INTO estado_en_proceso_id FROM "Estado" WHERE nombre = 'En Proceso';

    -- Asignar ambos valores
    NEW.id_etapa := etapa_inicial_id;
    NEW.id_estado := estado_en_proceso_id;

    RETURN NEW;
END;$$;


ALTER FUNCTION public.inicializar_etapa_estado_orden() OWNER TO postgres;

SET default_tablespace = '';

SET default_table_access_method = heap;

--
-- Name: Acabado; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Acabado" (
    id_acabado integer NOT NULL,
    nombre character varying
);


ALTER TABLE public."Acabado" OWNER TO postgres;

--
-- Name: AcabadoTipo; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."AcabadoTipo" (
    id_acabado_tipo integer NOT NULL,
    id_acabado integer,
    id_tipo integer
);


ALTER TABLE public."AcabadoTipo" OWNER TO postgres;

--
-- Name: AcabadoTipo_id_acabado_tipo_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."AcabadoTipo" ALTER COLUMN id_acabado_tipo ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."AcabadoTipo_id_acabado_tipo_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: Acabado_id_acabado_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."Acabado" ALTER COLUMN id_acabado ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Acabado_id_acabado_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: Archivo; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Archivo" (
    id_archivo integer NOT NULL,
    nombre character varying(255),
    tipo character varying(50),
    ruta character varying(255) NOT NULL,
    fecha_subida timestamp without time zone DEFAULT now(),
    orden_id integer,
    "tamaño" integer,
    descripcion character varying(255),
    usuario_id integer
);


ALTER TABLE public."Archivo" OWNER TO postgres;

--
-- Name: Cliente; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Cliente" (
    id_cliente integer NOT NULL,
    nombre character varying,
    trabajo character varying
);


ALTER TABLE public."Cliente" OWNER TO postgres;

--
-- Name: Cliente_id_cliente_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."Cliente" ALTER COLUMN id_cliente ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Cliente_id_cliente_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: ControlCalidadFinal; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."ControlCalidadFinal" (
    id_control_calidad integer NOT NULL,
    id_orden_trabajo integer,
    fecha_control timestamp with time zone,
    aprobado boolean,
    cantidad_inspeccionada integer,
    cantidad_defectuosa integer,
    observaciones text,
    id_usuario integer
);


ALTER TABLE public."ControlCalidadFinal" OWNER TO postgres;

--
-- Name: ControlCalidadFinal_id_control_calidad_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."ControlCalidadFinal" ALTER COLUMN id_control_calidad ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."ControlCalidadFinal_id_control_calidad_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: ControlPostPrensa; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."ControlPostPrensa" (
    id_control_post_prensa integer NOT NULL,
    id_orden_trabajo integer,
    id_maquina integer,
    id_usuario integer,
    stamping_color boolean,
    stamping_registro boolean,
    medio_corte_medida boolean,
    medio_corte_liner boolean,
    relieve_registro boolean,
    relieve_altura boolean,
    relieve_liner boolean,
    serigrafia_shablon_nro boolean,
    serigrafia_volumen boolean,
    serigrafia_control_frote boolean,
    serigrafia_registro boolean,
    exam_impresion boolean,
    exam_stamping boolean,
    exam_relieve boolean,
    exam_serigrafia boolean,
    exam_troquelado boolean,
    exam_cantidad boolean,
    firma_stamping character varying,
    firma_relieve character varying,
    firma_serigrafia character varying,
    firma_medio_corte character varying,
    firma_examinadora character varying,
    observaciones text
);


ALTER TABLE public."ControlPostPrensa" OWNER TO postgres;

--
-- Name: ControlPostPrensa_id_control_post_prensa_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."ControlPostPrensa" ALTER COLUMN id_control_post_prensa ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."ControlPostPrensa_id_control_post_prensa_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: ControlPrePrensa; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."ControlPrePrensa" (
    id_control_preprensa integer NOT NULL,
    id_orden_trabajo integer,
    id_usuario integer,
    observaciones text
);


ALTER TABLE public."ControlPrePrensa" OWNER TO postgres;

--
-- Name: ControlPrePrensa_id_control_preprensa_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."ControlPrePrensa" ALTER COLUMN id_control_preprensa ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."ControlPrePrensa_id_control_preprensa_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: ControlPrensa; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."ControlPrensa" (
    id_control_prensa integer NOT NULL,
    id_orden_trabajo integer,
    observaciones text,
    metros_registro double precision,
    metros_impresos double precision,
    id_usuario integer
);


ALTER TABLE public."ControlPrensa" OWNER TO postgres;

--
-- Name: ControlPrensa_id_control_prensa_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."ControlPrensa" ALTER COLUMN id_control_prensa ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."ControlPrensa_id_control_prensa_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: Estado; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Estado" (
    id_estado integer NOT NULL,
    nombre character varying(50) NOT NULL,
    descripcion character varying(100) NOT NULL
);


ALTER TABLE public."Estado" OWNER TO postgres;

--
-- Name: Etapa; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Etapa" (
    id_etapa integer NOT NULL,
    nombre character varying(50),
    orden integer
);


ALTER TABLE public."Etapa" OWNER TO postgres;

--
-- Name: Etapa_id_etapa_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."Etapa" ALTER COLUMN id_etapa ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Etapa_id_etapa_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: Maquina; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Maquina" (
    id_maquina integer NOT NULL,
    nombre character varying,
    tipo character varying
);


ALTER TABLE public."Maquina" OWNER TO postgres;

--
-- Name: Maquina_id_maquina_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."Maquina" ALTER COLUMN id_maquina ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Maquina_id_maquina_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: OrdenTrabajo; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."OrdenTrabajo" (
    id_orden_trabajo integer NOT NULL,
    cliente_id integer,
    id_tipo_troquelado integer,
    id_sistema integer,
    id_etapa integer,
    id_usuario integer,
    numero_lote character varying,
    fecha_creacion timestamp with time zone DEFAULT now(),
    id_estado integer,
    soporte character varying,
    alto_mm numeric,
    ancho_mm numeric,
    z integer,
    desarrollo integer,
    alto_desarrollo integer,
    metros numeric,
    demasia numeric,
    cantidad_rollos integer,
    banda integer,
    lado character varying,
    sentido_bobina integer,
    cantidad_etiquetas integer,
    observaciones text
);


ALTER TABLE public."OrdenTrabajo" OWNER TO postgres;

--
-- Name: OrdenTrabajoAcabado; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."OrdenTrabajoAcabado" (
    id integer NOT NULL,
    id_orden_trabajo integer,
    id_acabado_tipo integer
);


ALTER TABLE public."OrdenTrabajoAcabado" OWNER TO postgres;

--
-- Name: OrdenTrabajoAcabado_id_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."OrdenTrabajoAcabado" ALTER COLUMN id ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."OrdenTrabajoAcabado_id_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: OrdenTrabajoTinta; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."OrdenTrabajoTinta" (
    id_orden_trabajo_tinta integer NOT NULL,
    id_orden_trabajo integer,
    id_tinta integer
);


ALTER TABLE public."OrdenTrabajoTinta" OWNER TO postgres;

--
-- Name: OrdenTrabajoTinta_id_orden_trabajo_tinta_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."OrdenTrabajoTinta" ALTER COLUMN id_orden_trabajo_tinta ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."OrdenTrabajoTinta_id_orden_trabajo_tinta_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: OrdenTrabajo_id_orden_trabajo_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."OrdenTrabajo" ALTER COLUMN id_orden_trabajo ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."OrdenTrabajo_id_orden_trabajo_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: RegistroTiempoEtapa; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."RegistroTiempoEtapa" (
    id_registro_tiempo integer NOT NULL,
    id_orden_trabajo integer,
    id_etapa integer,
    id_usuario integer,
    id_maquina integer,
    fecha_inicio timestamp with time zone,
    fecha_fin timestamp with time zone,
    duracion_min integer,
    observaciones text
);


ALTER TABLE public."RegistroTiempoEtapa" OWNER TO postgres;

--
-- Name: RegistroTiempoEtapa_id_registro_tiempo_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."RegistroTiempoEtapa" ALTER COLUMN id_registro_tiempo ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."RegistroTiempoEtapa_id_registro_tiempo_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: Remito; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Remito" (
    id_remito integer NOT NULL,
    numero_remito character varying NOT NULL,
    id_orden_trabajo integer,
    fecha_emision timestamp with time zone,
    cantidad_entregada integer,
    observaciones text,
    id_usuario integer
);


ALTER TABLE public."Remito" OWNER TO postgres;

--
-- Name: Remito_id_remito_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."Remito" ALTER COLUMN id_remito ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Remito_id_remito_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: Rol; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Rol" (
    id_rol integer NOT NULL,
    nombre character varying NOT NULL,
    descripcion character varying
);


ALTER TABLE public."Rol" OWNER TO postgres;

--
-- Name: Rol_id_rol_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."Rol" ALTER COLUMN id_rol ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Rol_id_rol_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: SistemaImpresion; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."SistemaImpresion" (
    id_sistema_impresion integer NOT NULL,
    nombre character varying,
    codigo character varying
);


ALTER TABLE public."SistemaImpresion" OWNER TO postgres;

--
-- Name: SistemaImpresion_id_sistema_impresion_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."SistemaImpresion" ALTER COLUMN id_sistema_impresion ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."SistemaImpresion_id_sistema_impresion_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: Tinta; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Tinta" (
    id_tinta integer NOT NULL,
    nombre character varying,
    codigo_color character varying,
    color_hex character(7)
);


ALTER TABLE public."Tinta" OWNER TO postgres;

--
-- Name: Tinta_id_tinta_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."Tinta" ALTER COLUMN id_tinta ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Tinta_id_tinta_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: Tipo; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Tipo" (
    id_tipo integer NOT NULL,
    tipo character varying
);


ALTER TABLE public."Tipo" OWNER TO postgres;

--
-- Name: Tipo_id_tipo_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."Tipo" ALTER COLUMN id_tipo ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Tipo_id_tipo_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: Troquelado; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Troquelado" (
    id_troquelado integer NOT NULL,
    nombre character varying
);


ALTER TABLE public."Troquelado" OWNER TO postgres;

--
-- Name: Troquelado_id_troquelado_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."Troquelado" ALTER COLUMN id_troquelado ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Troquelado_id_troquelado_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: Usuario; Type: TABLE; Schema: public; Owner: postgres
--

CREATE TABLE public."Usuario" (
    id_usuario integer NOT NULL,
    id_rol integer,
    nombre character varying,
    email character varying NOT NULL,
    password_hash character varying NOT NULL,
    is_activo boolean,
    creado_en timestamp with time zone DEFAULT now()
);


ALTER TABLE public."Usuario" OWNER TO postgres;

--
-- Name: Usuario_id_usuario_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

ALTER TABLE public."Usuario" ALTER COLUMN id_usuario ADD GENERATED BY DEFAULT AS IDENTITY (
    SEQUENCE NAME public."Usuario_id_usuario_seq"
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1
);


--
-- Name: archivo_id_archivo_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.archivo_id_archivo_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.archivo_id_archivo_seq OWNER TO postgres;

--
-- Name: archivo_id_archivo_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.archivo_id_archivo_seq OWNED BY public."Archivo".id_archivo;


--
-- Name: estado_id_estado_seq; Type: SEQUENCE; Schema: public; Owner: postgres
--

CREATE SEQUENCE public.estado_id_estado_seq
    AS integer
    START WITH 1
    INCREMENT BY 1
    NO MINVALUE
    NO MAXVALUE
    CACHE 1;


ALTER SEQUENCE public.estado_id_estado_seq OWNER TO postgres;

--
-- Name: estado_id_estado_seq; Type: SEQUENCE OWNED BY; Schema: public; Owner: postgres
--

ALTER SEQUENCE public.estado_id_estado_seq OWNED BY public."Estado".id_estado;


--
-- Name: Archivo id_archivo; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Archivo" ALTER COLUMN id_archivo SET DEFAULT nextval('public.archivo_id_archivo_seq'::regclass);


--
-- Name: Estado id_estado; Type: DEFAULT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Estado" ALTER COLUMN id_estado SET DEFAULT nextval('public.estado_id_estado_seq'::regclass);


--
-- Data for Name: Acabado; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Acabado" (id_acabado, nombre) FROM stdin;
1	Barniz Antifrote
2	Stamping Oro
3	Sectorizado Volumétrico
4	Relieve
\.


--
-- Data for Name: AcabadoTipo; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."AcabadoTipo" (id_acabado_tipo, id_acabado, id_tipo) FROM stdin;
1	1	1
2	1	2
3	2	1
4	2	2
5	3	3
6	4	3
\.


--
-- Data for Name: Archivo; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Archivo" (id_archivo, nombre, tipo, ruta, fecha_subida, orden_id, "tamaño", descripcion, usuario_id) FROM stdin;
15	etiqueta_vino_prueba.png	image/png	uploads/1757298998.509502_etiqueta_vino_prueba.png	2025-09-07 23:36:38.510621	19	\N	\N	\N
16	glc-plantillas-etiquetas-vino-editables-online-editar.jpg	image/jpeg	uploads/567_glc-plantillas-etiquetas-vino-editables-online-editar.jpg	2025-09-25 14:56:45.293324	5	\N	\N	\N
17	etiqueta_vino_prueba.png	image/png	uploads/256_etiqueta_vino_prueba.png	2025-09-25 15:03:16.752347	18	\N	\N	\N
20	glc-plantillas-etiquetas-vino-editables-online-editar.jpg	image/jpeg	uploads/2812_glc-plantillas-etiquetas-vino-editables-online-editar.jpg	2025-09-25 16:47:42.23025	4	\N	\N	\N
22	imagen_prueba.jpeg	image/jpeg	uploads/900_imagen_prueba.jpeg	2025-10-13 20:47:49.970661	20	\N	\N	\N
11	6op-etiqueta-vino-editor-online-plantilla-editable.webp	image/webp	uploads/1758821345.36983_6op-etiqueta-vino-editor-online-plantilla-editable.webp	2025-09-25 14:29:05.371336	\N	\N	\N	\N
24	Abstract - Nature.jpg	image/jpeg	uploads/65_Abstract - Nature.jpg	2025-11-02 21:55:15.021526	24	\N	\N	\N
\.


--
-- Data for Name: Cliente; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Cliente" (id_cliente, nombre, trabajo) FROM stdin;
5	jose	vino
3	Belhar	Becas Reserva Mb 2024
\.


--
-- Data for Name: ControlCalidadFinal; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."ControlCalidadFinal" (id_control_calidad, id_orden_trabajo, fecha_control, aprobado, cantidad_inspeccionada, cantidad_defectuosa, observaciones, id_usuario) FROM stdin;
2	4	2025-08-13 16:21:00-03	t	12000	100	prueba 2	8
3	18	\N	t	12	31	\N	8
4	21	2025-08-16 16:38:00-03	t	124	124	\N	8
\.


--
-- Data for Name: ControlPostPrensa; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."ControlPostPrensa" (id_control_post_prensa, id_orden_trabajo, id_maquina, id_usuario, stamping_color, stamping_registro, medio_corte_medida, medio_corte_liner, relieve_registro, relieve_altura, relieve_liner, serigrafia_shablon_nro, serigrafia_volumen, serigrafia_control_frote, serigrafia_registro, exam_impresion, exam_stamping, exam_relieve, exam_serigrafia, exam_troquelado, exam_cantidad, firma_stamping, firma_relieve, firma_serigrafia, firma_medio_corte, firma_examinadora, observaciones) FROM stdin;
2	4	1	8	t	f	f	f	f	f	f	f	f	t	f	f	f	f	f	f	f	prueba 2	jose	prueba	awd	faf	prueba 2
3	18	1	8	t	f	f	f	f	f	f	t	f	f	t	f	f	f	f	f	f	\N	\N	\N	\N	\N	\N
4	21	1	8	f	f	t	f	f	f	f	f	f	f	f	f	t	f	f	f	f	\N	\N	\N	\N	\N	\N
\.


--
-- Data for Name: ControlPrePrensa; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."ControlPrePrensa" (id_control_preprensa, id_orden_trabajo, id_usuario, observaciones) FROM stdin;
11	4	8	prueba 2
13	5	8	\N
14	18	8	\N
15	21	8	\N
\.


--
-- Data for Name: ControlPrensa; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."ControlPrensa" (id_control_prensa, id_orden_trabajo, observaciones, metros_registro, metros_impresos, id_usuario) FROM stdin;
17	19	test	170	120	8
\.


--
-- Data for Name: Estado; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Estado" (id_estado, nombre, descripcion) FROM stdin;
1	En Proceso	La orden de trabajo esta en proceso
2	Finalizado	La orden de trabajo finalizo
3	Entregado	La orden de trabajo esta finalizado y se entrego a cliente
\.


--
-- Data for Name: Etapa; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Etapa" (id_etapa, nombre, orden) FROM stdin;
1	PrePrensa	1
2	Prensa	2
3	PostPrensa	3
4	Control de Calidad	4
5	Remito	5
\.


--
-- Data for Name: Maquina; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Maquina" (id_maquina, nombre, tipo) FROM stdin;
1	Maquina 1	1
\.


--
-- Data for Name: OrdenTrabajo; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."OrdenTrabajo" (id_orden_trabajo, cliente_id, id_tipo_troquelado, id_sistema, id_etapa, id_usuario, numero_lote, fecha_creacion, id_estado, soporte, alto_mm, ancho_mm, z, desarrollo, alto_desarrollo, metros, demasia, cantidad_rollos, banda, lado, sentido_bobina, cantidad_etiquetas, observaciones) FROM stdin;
19	3	2	2	2	1	478	2025-08-16 17:49:30.090228-03	1	Martele	12	34	23	3	1	23	45	12	234	Frente	4	26	prueba trigger 2
5	5	1	2	1	1	567	2025-08-13 20:27:37.076046-03	\N	Martele	34	34	3	3	44	2	4	5	4	Frente	4	26	ok
18	5	1	1	5	1	256	2025-08-16 17:23:20.858709-03	3	Martele	1	1	1	1	1	1	1	1	1	Frente	4	26	Archivo de Souvenir
4	5	1	1	1	8	2812	2025-08-13 19:18:56.279576-03	\N	Martele	84.6	116	22	3	1	2.4	1	11	125	Frente	4	26	todo ok
24	5	\N	1	1	1	65	2025-10-27 17:44:48.938783-03	1	Martele	84.9	21.5	3	21	1	33	2	13	23	Frente	2	26	test creacion
20	5	\N	\N	1	\N	900	2025-08-16 18:33:31.658391-03	1	Martele	85.6	115	2	2	2	2	2	2	125	Frente	4	26	prueba sacar editar o crear etapa y estado
21	3	\N	\N	5	\N	901	2025-08-16 18:45:26.922501-03	2	Martele	1	1	1	1	1	1	1	1	1	1	1	1	1
22	3	\N	1	1	1	67	2025-10-27 17:42:31.909976-03	1	Martele	84.9	21.5	3	21	1	33	2	13	23	Frente	2	26	test creacion
\.


--
-- Data for Name: OrdenTrabajoAcabado; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."OrdenTrabajoAcabado" (id, id_orden_trabajo, id_acabado_tipo) FROM stdin;
\.


--
-- Data for Name: OrdenTrabajoTinta; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."OrdenTrabajoTinta" (id_orden_trabajo_tinta, id_orden_trabajo, id_tinta) FROM stdin;
\.


--
-- Data for Name: RegistroTiempoEtapa; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."RegistroTiempoEtapa" (id_registro_tiempo, id_orden_trabajo, id_etapa, id_usuario, id_maquina, fecha_inicio, fecha_fin, duracion_min, observaciones) FROM stdin;
\.


--
-- Data for Name: Remito; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Remito" (id_remito, numero_remito, id_orden_trabajo, fecha_emision, cantidad_entregada, observaciones, id_usuario) FROM stdin;
2	11	4	2025-08-13 16:21:00-03	12000	prueba 2	8
3	13	18	2025-08-16 15:16:00-03	25	\N	8
\.


--
-- Data for Name: Rol; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Rol" (id_rol, nombre, descripcion) FROM stdin;
1	Administrador	Tiene acceso completo al sistema
2	Operador	Usuario que opera el sistema pero con permisos limitados
\.


--
-- Data for Name: SistemaImpresion; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."SistemaImpresion" (id_sistema_impresion, nombre, codigo) FROM stdin;
1	Flex	1
2	digital	2
\.


--
-- Data for Name: Tinta; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Tinta" (id_tinta, nombre, codigo_color, color_hex) FROM stdin;
\.


--
-- Data for Name: Tipo; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Tipo" (id_tipo, tipo) FROM stdin;
1	Mate
2	Brillante
3	Sin tipo
\.


--
-- Data for Name: Troquelado; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Troquelado" (id_troquelado, nombre) FROM stdin;
1	Plano
2	Medio Corte
\.


--
-- Data for Name: Usuario; Type: TABLE DATA; Schema: public; Owner: postgres
--

COPY public."Usuario" (id_usuario, id_rol, nombre, email, password_hash, is_activo, creado_en) FROM stdin;
1	1	Renzo	renzo@gmail.com	$2b$12$JwqUeWawyqghdL2ZewXYrOdCE2GVdvQrqKyVMl9JK4f8NMG2titBe	t	\N
8	2	Sebastian	sebastianfernandez2812@gmail.com	$2b$12$5Lttj2yuHSovDw2.TCZEsu/5heE0Hv541Plktv5bMOWtsfQcq/7km	t	2025-08-11 20:17:37.968116-03
\.


--
-- Name: AcabadoTipo_id_acabado_tipo_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."AcabadoTipo_id_acabado_tipo_seq"', 1, true);


--
-- Name: Acabado_id_acabado_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."Acabado_id_acabado_seq"', 4, true);


--
-- Name: Cliente_id_cliente_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."Cliente_id_cliente_seq"', 5, true);


--
-- Name: ControlCalidadFinal_id_control_calidad_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."ControlCalidadFinal_id_control_calidad_seq"', 4, true);


--
-- Name: ControlPostPrensa_id_control_post_prensa_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."ControlPostPrensa_id_control_post_prensa_seq"', 4, true);


--
-- Name: ControlPrePrensa_id_control_preprensa_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."ControlPrePrensa_id_control_preprensa_seq"', 15, true);


--
-- Name: ControlPrensa_id_control_prensa_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."ControlPrensa_id_control_prensa_seq"', 17, true);


--
-- Name: Etapa_id_etapa_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."Etapa_id_etapa_seq"', 5, true);


--
-- Name: Maquina_id_maquina_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."Maquina_id_maquina_seq"', 1, true);


--
-- Name: OrdenTrabajoAcabado_id_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."OrdenTrabajoAcabado_id_seq"', 1, false);


--
-- Name: OrdenTrabajoTinta_id_orden_trabajo_tinta_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."OrdenTrabajoTinta_id_orden_trabajo_tinta_seq"', 1, false);


--
-- Name: OrdenTrabajo_id_orden_trabajo_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."OrdenTrabajo_id_orden_trabajo_seq"', 24, true);


--
-- Name: RegistroTiempoEtapa_id_registro_tiempo_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."RegistroTiempoEtapa_id_registro_tiempo_seq"', 1, false);


--
-- Name: Remito_id_remito_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."Remito_id_remito_seq"', 3, true);


--
-- Name: Rol_id_rol_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."Rol_id_rol_seq"', 3, true);


--
-- Name: SistemaImpresion_id_sistema_impresion_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."SistemaImpresion_id_sistema_impresion_seq"', 2, true);


--
-- Name: Tinta_id_tinta_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."Tinta_id_tinta_seq"', 1, false);


--
-- Name: Tipo_id_tipo_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."Tipo_id_tipo_seq"', 3, true);


--
-- Name: Troquelado_id_troquelado_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."Troquelado_id_troquelado_seq"', 2, true);


--
-- Name: Usuario_id_usuario_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public."Usuario_id_usuario_seq"', 8, true);


--
-- Name: archivo_id_archivo_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.archivo_id_archivo_seq', 24, true);


--
-- Name: estado_id_estado_seq; Type: SEQUENCE SET; Schema: public; Owner: postgres
--

SELECT pg_catalog.setval('public.estado_id_estado_seq', 3, true);


--
-- Name: AcabadoTipo AcabadoTipo_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."AcabadoTipo"
    ADD CONSTRAINT "AcabadoTipo_pkey" PRIMARY KEY (id_acabado_tipo);


--
-- Name: Acabado Acabado_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Acabado"
    ADD CONSTRAINT "Acabado_pkey" PRIMARY KEY (id_acabado);


--
-- Name: Cliente Cliente_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Cliente"
    ADD CONSTRAINT "Cliente_pkey" PRIMARY KEY (id_cliente);


--
-- Name: ControlCalidadFinal ControlCalidadFinal_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlCalidadFinal"
    ADD CONSTRAINT "ControlCalidadFinal_pkey" PRIMARY KEY (id_control_calidad);


--
-- Name: ControlPostPrensa ControlPostPrensa_id_orden_trabajo_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPostPrensa"
    ADD CONSTRAINT "ControlPostPrensa_id_orden_trabajo_key" UNIQUE (id_orden_trabajo);


--
-- Name: ControlPostPrensa ControlPostPrensa_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPostPrensa"
    ADD CONSTRAINT "ControlPostPrensa_pkey" PRIMARY KEY (id_control_post_prensa);


--
-- Name: ControlPrePrensa ControlPrePrensa_id_orden_trabajo_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPrePrensa"
    ADD CONSTRAINT "ControlPrePrensa_id_orden_trabajo_key" UNIQUE (id_orden_trabajo);


--
-- Name: ControlPrePrensa ControlPrePrensa_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPrePrensa"
    ADD CONSTRAINT "ControlPrePrensa_pkey" PRIMARY KEY (id_control_preprensa);


--
-- Name: ControlPrensa ControlPrensa_id_orden_trabajo_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPrensa"
    ADD CONSTRAINT "ControlPrensa_id_orden_trabajo_key" UNIQUE (id_orden_trabajo);


--
-- Name: ControlPrensa ControlPrensa_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPrensa"
    ADD CONSTRAINT "ControlPrensa_pkey" PRIMARY KEY (id_control_prensa);


--
-- Name: Etapa Etapa_nombre_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Etapa"
    ADD CONSTRAINT "Etapa_nombre_key" UNIQUE (nombre);


--
-- Name: Etapa Etapa_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Etapa"
    ADD CONSTRAINT "Etapa_pkey" PRIMARY KEY (id_etapa);


--
-- Name: Maquina Maquina_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Maquina"
    ADD CONSTRAINT "Maquina_pkey" PRIMARY KEY (id_maquina);


--
-- Name: OrdenTrabajoAcabado OrdenTrabajoAcabado_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajoAcabado"
    ADD CONSTRAINT "OrdenTrabajoAcabado_pkey" PRIMARY KEY (id);


--
-- Name: OrdenTrabajoTinta OrdenTrabajoTinta_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajoTinta"
    ADD CONSTRAINT "OrdenTrabajoTinta_pkey" PRIMARY KEY (id_orden_trabajo_tinta);


--
-- Name: OrdenTrabajo OrdenTrabajo_numero_lote_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajo"
    ADD CONSTRAINT "OrdenTrabajo_numero_lote_key" UNIQUE (numero_lote);


--
-- Name: OrdenTrabajo OrdenTrabajo_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajo"
    ADD CONSTRAINT "OrdenTrabajo_pkey" PRIMARY KEY (id_orden_trabajo);


--
-- Name: RegistroTiempoEtapa RegistroTiempoEtapa_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."RegistroTiempoEtapa"
    ADD CONSTRAINT "RegistroTiempoEtapa_pkey" PRIMARY KEY (id_registro_tiempo);


--
-- Name: Remito Remito_numero_remito_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Remito"
    ADD CONSTRAINT "Remito_numero_remito_key" UNIQUE (numero_remito);


--
-- Name: Remito Remito_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Remito"
    ADD CONSTRAINT "Remito_pkey" PRIMARY KEY (id_remito);


--
-- Name: Rol Rol_nombre_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Rol"
    ADD CONSTRAINT "Rol_nombre_key" UNIQUE (nombre);


--
-- Name: Rol Rol_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Rol"
    ADD CONSTRAINT "Rol_pkey" PRIMARY KEY (id_rol);


--
-- Name: SistemaImpresion SistemaImpresion_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."SistemaImpresion"
    ADD CONSTRAINT "SistemaImpresion_pkey" PRIMARY KEY (id_sistema_impresion);


--
-- Name: Tinta Tinta_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Tinta"
    ADD CONSTRAINT "Tinta_pkey" PRIMARY KEY (id_tinta);


--
-- Name: Tipo Tipo_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Tipo"
    ADD CONSTRAINT "Tipo_pkey" PRIMARY KEY (id_tipo);


--
-- Name: Troquelado Troquelado_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Troquelado"
    ADD CONSTRAINT "Troquelado_pkey" PRIMARY KEY (id_troquelado);


--
-- Name: Usuario Usuario_email_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Usuario"
    ADD CONSTRAINT "Usuario_email_key" UNIQUE (email);


--
-- Name: Usuario Usuario_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Usuario"
    ADD CONSTRAINT "Usuario_pkey" PRIMARY KEY (id_usuario);


--
-- Name: Archivo archivo_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Archivo"
    ADD CONSTRAINT archivo_pkey PRIMARY KEY (id_archivo);


--
-- Name: Estado estado_nombre_key; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Estado"
    ADD CONSTRAINT estado_nombre_key UNIQUE (nombre);


--
-- Name: Estado estado_pkey; Type: CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Estado"
    ADD CONSTRAINT estado_pkey PRIMARY KEY (id_estado);


--
-- Name: AcabadoTipo_id_acabado_id_tipo_idx; Type: INDEX; Schema: public; Owner: postgres
--

CREATE UNIQUE INDEX "AcabadoTipo_id_acabado_id_tipo_idx" ON public."AcabadoTipo" USING btree (id_acabado, id_tipo);


--
-- Name: ControlPostPrensa trigger_avanzar_etapa_control_postprensa; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER trigger_avanzar_etapa_control_postprensa AFTER INSERT ON public."ControlPostPrensa" FOR EACH ROW EXECUTE FUNCTION public.avanzar_etapa_y_estado();


--
-- Name: ControlPrensa trigger_avanzar_etapa_control_prensa; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER trigger_avanzar_etapa_control_prensa AFTER INSERT ON public."ControlPrensa" FOR EACH ROW EXECUTE FUNCTION public.avanzar_etapa_y_estado();


--
-- Name: ControlPrePrensa trigger_avanzar_etapa_control_preprensa; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER trigger_avanzar_etapa_control_preprensa AFTER INSERT ON public."ControlPrePrensa" FOR EACH ROW EXECUTE FUNCTION public.avanzar_etapa_y_estado();


--
-- Name: Remito trigger_entregar_orden; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER trigger_entregar_orden AFTER INSERT ON public."Remito" FOR EACH ROW EXECUTE FUNCTION public.avanzar_etapa_y_estado();


--
-- Name: ControlCalidadFinal trigger_finalizar_orden; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER trigger_finalizar_orden AFTER INSERT ON public."ControlCalidadFinal" FOR EACH ROW EXECUTE FUNCTION public.avanzar_etapa_y_estado();


--
-- Name: OrdenTrabajo trigger_inicializar_etapa_estado; Type: TRIGGER; Schema: public; Owner: postgres
--

CREATE TRIGGER trigger_inicializar_etapa_estado BEFORE INSERT ON public."OrdenTrabajo" FOR EACH ROW EXECUTE FUNCTION public.inicializar_etapa_estado_orden();


--
-- Name: AcabadoTipo AcabadoTipo_id_acabado_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."AcabadoTipo"
    ADD CONSTRAINT "AcabadoTipo_id_acabado_fkey" FOREIGN KEY (id_acabado) REFERENCES public."Acabado"(id_acabado);


--
-- Name: AcabadoTipo AcabadoTipo_id_tipo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."AcabadoTipo"
    ADD CONSTRAINT "AcabadoTipo_id_tipo_fkey" FOREIGN KEY (id_tipo) REFERENCES public."Tipo"(id_tipo);


--
-- Name: Archivo Archivo_orden_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Archivo"
    ADD CONSTRAINT "Archivo_orden_id_fkey" FOREIGN KEY (orden_id) REFERENCES public."OrdenTrabajo"(id_orden_trabajo) ON DELETE CASCADE;


--
-- Name: ControlCalidadFinal ControlCalidadFinal_id_orden_trabajo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlCalidadFinal"
    ADD CONSTRAINT "ControlCalidadFinal_id_orden_trabajo_fkey" FOREIGN KEY (id_orden_trabajo) REFERENCES public."OrdenTrabajo"(id_orden_trabajo) ON DELETE CASCADE;


--
-- Name: ControlCalidadFinal ControlCalidadFinal_id_usuario_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlCalidadFinal"
    ADD CONSTRAINT "ControlCalidadFinal_id_usuario_fkey" FOREIGN KEY (id_usuario) REFERENCES public."Usuario"(id_usuario);


--
-- Name: ControlPostPrensa ControlPostPrensa_id_maquina_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPostPrensa"
    ADD CONSTRAINT "ControlPostPrensa_id_maquina_fkey" FOREIGN KEY (id_maquina) REFERENCES public."Maquina"(id_maquina);


--
-- Name: ControlPostPrensa ControlPostPrensa_id_orden_trabajo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPostPrensa"
    ADD CONSTRAINT "ControlPostPrensa_id_orden_trabajo_fkey" FOREIGN KEY (id_orden_trabajo) REFERENCES public."OrdenTrabajo"(id_orden_trabajo) ON DELETE CASCADE;


--
-- Name: ControlPostPrensa ControlPostPrensa_id_usuario_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPostPrensa"
    ADD CONSTRAINT "ControlPostPrensa_id_usuario_fkey" FOREIGN KEY (id_usuario) REFERENCES public."Usuario"(id_usuario);


--
-- Name: ControlPrePrensa ControlPrePrensa_id_orden_trabajo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPrePrensa"
    ADD CONSTRAINT "ControlPrePrensa_id_orden_trabajo_fkey" FOREIGN KEY (id_orden_trabajo) REFERENCES public."OrdenTrabajo"(id_orden_trabajo) ON DELETE CASCADE;


--
-- Name: ControlPrePrensa ControlPrePrensa_id_usuario_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPrePrensa"
    ADD CONSTRAINT "ControlPrePrensa_id_usuario_fkey" FOREIGN KEY (id_usuario) REFERENCES public."Usuario"(id_usuario);


--
-- Name: ControlPrensa ControlPrensa_id_orden_trabajo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."ControlPrensa"
    ADD CONSTRAINT "ControlPrensa_id_orden_trabajo_fkey" FOREIGN KEY (id_orden_trabajo) REFERENCES public."OrdenTrabajo"(id_orden_trabajo) ON DELETE CASCADE;


--
-- Name: OrdenTrabajoAcabado OrdenTrabajoAcabado_id_acabado_tipo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajoAcabado"
    ADD CONSTRAINT "OrdenTrabajoAcabado_id_acabado_tipo_fkey" FOREIGN KEY (id_acabado_tipo) REFERENCES public."AcabadoTipo"(id_acabado_tipo);


--
-- Name: OrdenTrabajoAcabado OrdenTrabajoAcabado_id_orden_trabajo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajoAcabado"
    ADD CONSTRAINT "OrdenTrabajoAcabado_id_orden_trabajo_fkey" FOREIGN KEY (id_orden_trabajo) REFERENCES public."OrdenTrabajo"(id_orden_trabajo);


--
-- Name: OrdenTrabajoTinta OrdenTrabajoTinta_id_orden_trabajo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajoTinta"
    ADD CONSTRAINT "OrdenTrabajoTinta_id_orden_trabajo_fkey" FOREIGN KEY (id_orden_trabajo) REFERENCES public."OrdenTrabajo"(id_orden_trabajo);


--
-- Name: OrdenTrabajoTinta OrdenTrabajoTinta_id_tinta_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajoTinta"
    ADD CONSTRAINT "OrdenTrabajoTinta_id_tinta_fkey" FOREIGN KEY (id_tinta) REFERENCES public."Tinta"(id_tinta);


--
-- Name: OrdenTrabajo OrdenTrabajo_cliente_id_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajo"
    ADD CONSTRAINT "OrdenTrabajo_cliente_id_fkey" FOREIGN KEY (cliente_id) REFERENCES public."Cliente"(id_cliente);


--
-- Name: OrdenTrabajo OrdenTrabajo_id_etapa_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajo"
    ADD CONSTRAINT "OrdenTrabajo_id_etapa_fkey" FOREIGN KEY (id_etapa) REFERENCES public."Etapa"(id_etapa);


--
-- Name: OrdenTrabajo OrdenTrabajo_id_sistema_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajo"
    ADD CONSTRAINT "OrdenTrabajo_id_sistema_fkey" FOREIGN KEY (id_sistema) REFERENCES public."SistemaImpresion"(id_sistema_impresion);


--
-- Name: OrdenTrabajo OrdenTrabajo_id_tipo_troquelado_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajo"
    ADD CONSTRAINT "OrdenTrabajo_id_tipo_troquelado_fkey" FOREIGN KEY (id_tipo_troquelado) REFERENCES public."Troquelado"(id_troquelado);


--
-- Name: OrdenTrabajo OrdenTrabajo_id_usuario_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajo"
    ADD CONSTRAINT "OrdenTrabajo_id_usuario_fkey" FOREIGN KEY (id_usuario) REFERENCES public."Usuario"(id_usuario);


--
-- Name: RegistroTiempoEtapa RegistroTiempoEtapa_id_etapa_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."RegistroTiempoEtapa"
    ADD CONSTRAINT "RegistroTiempoEtapa_id_etapa_fkey" FOREIGN KEY (id_etapa) REFERENCES public."Etapa"(id_etapa);


--
-- Name: RegistroTiempoEtapa RegistroTiempoEtapa_id_maquina_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."RegistroTiempoEtapa"
    ADD CONSTRAINT "RegistroTiempoEtapa_id_maquina_fkey" FOREIGN KEY (id_maquina) REFERENCES public."Maquina"(id_maquina);


--
-- Name: RegistroTiempoEtapa RegistroTiempoEtapa_id_orden_trabajo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."RegistroTiempoEtapa"
    ADD CONSTRAINT "RegistroTiempoEtapa_id_orden_trabajo_fkey" FOREIGN KEY (id_orden_trabajo) REFERENCES public."OrdenTrabajo"(id_orden_trabajo);


--
-- Name: RegistroTiempoEtapa RegistroTiempoEtapa_id_usuario_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."RegistroTiempoEtapa"
    ADD CONSTRAINT "RegistroTiempoEtapa_id_usuario_fkey" FOREIGN KEY (id_usuario) REFERENCES public."Usuario"(id_usuario);


--
-- Name: Remito Remito_id_orden_trabajo_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Remito"
    ADD CONSTRAINT "Remito_id_orden_trabajo_fkey" FOREIGN KEY (id_orden_trabajo) REFERENCES public."OrdenTrabajo"(id_orden_trabajo) ON DELETE CASCADE;


--
-- Name: Remito Remito_id_usuario_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Remito"
    ADD CONSTRAINT "Remito_id_usuario_fkey" FOREIGN KEY (id_usuario) REFERENCES public."Usuario"(id_usuario);


--
-- Name: Usuario Usuario_id_rol_fkey; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."Usuario"
    ADD CONSTRAINT "Usuario_id_rol_fkey" FOREIGN KEY (id_rol) REFERENCES public."Rol"(id_rol);


--
-- Name: OrdenTrabajo id_estado; Type: FK CONSTRAINT; Schema: public; Owner: postgres
--

ALTER TABLE ONLY public."OrdenTrabajo"
    ADD CONSTRAINT id_estado FOREIGN KEY (id_estado) REFERENCES public."Estado"(id_estado);


--
-- PostgreSQL database dump complete
--

\unrestrict pNZ0j2nwKg3qf0Kbs17QiOZ7BLDn1Kk976cHoY7de7qpgtznbn1k1moBj4rTjAb

